load('~/Documents/gleon/watershedRoad.RData')
library(sp)
library(shapefiles)
library(rgeos)
library(rgdal)
library(maptools)
library(raster)
library(fastshp)
library(compiler)
enable(JIT=1)
enableJIT(1)
enableJIT(1)
roadlen<-function(coords)
i=205
print(paste("road file",i))
shpname<-files[i]
shpname<-paste(roadfilepath,shpname,sep='/')
roads<-readShapeLines(shpname,proj4string= CRS("+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"))
roads<-spTransform(roads,CRS('+proj=cea'))
library(sp)
library(shapefiles)
library(rgeos)
library(rgdal)
library(maptools)
library(raster)
library(fastshp)
library(compiler)
watershed.road<-data.frame(SITEID='',roadlen=0)
watershed.road$SITEID<-as.character(watershed.road$SITEID)
watershed.road<-watershed.road[-1,]
enableJIT(3)
enableJIT(3)
for(j in 1:watershed.num)
{
watershed.sub<-watersheds.proj[j,]
roadfile.indices=watershed.road.overlap[[j]]
print(paste("watershed",j))
for(i in roadfile.indices)
{
print(paste("road file",i))
shpname<-files[i]
shpname<-gsub('.shp','',shpname)
roads<-readOGR(roadfilepath,shpname,proj4string= CRS("+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"))
roads<-spTransform(roads,CRS('+proj=cea'))
try(rm('watershed.over'),silent=T)
watershed.over<-try(gIntersection(watershed.sub,roads,silent=T))
if(class(watershed.over)=='try-error')
{
bad<-!gIsValid(roads,byid=T)
roads[bad,]=gSimplify(roads[bad,],tol=0.0001)
watershed.over<-try(gIntersection(watershed.sub,roads,silent=T))
}
if(!is.null(watershed.over))
{
len<-road.lencalc(watershed.over)
watershed.road<-rbind(watershed.road,data.frame(SITEID=as.character(watershed.sub$SITEID),roadlen=len))
write.table(watershed.road,'output/roadlengthsByWatershed2.csv',col.names=T,quote=F,row.names=F,sep=',',append=F)
}
}
}
for(j in 1:watershed.num)
{
watershed.sub<-watersheds.proj[j,]
roadfile.indices=watershed.road.overlap[[j]]
print(paste("watershed",j))
for(i in roadfile.indices)
{
print(paste("road file",i))
shpname<-files[i]
shpname<-gsub('.shp','',shpname)
roads<-readOGR(roadfilepath,shpname)
roads<-spTransform(roads,CRS('+proj=cea'))
try(rm('watershed.over'),silent=T)
watershed.over<-try(gIntersection(watershed.sub,roads,silent=T))
if(class(watershed.over)=='try-error')
{
bad<-!gIsValid(roads,byid=T)
roads[bad,]=gSimplify(roads[bad,],tol=0.0001)
watershed.over<-try(gIntersection(watershed.sub,roads,silent=T))
}
if(!is.null(watershed.over))
{
len<-road.lencalc(watershed.over)
watershed.road<-rbind(watershed.road,data.frame(SITEID=as.character(watershed.sub$SITEID),roadlen=len))
write.table(watershed.road,'output/roadlengthsByWatershed2.csv',col.names=T,quote=F,row.names=F,sep=',',append=F)
}
}
}
enableJIT(1)
for(j in 1:watershed.num)
{
watershed.sub<-watersheds.proj[j,]
roadfile.indices=watershed.road.overlap[[j]]
print(paste("watershed",j))
for(i in roadfile.indices)
{
print(paste("road file",i))
shpname<-files[i]
shpname<-gsub('.shp','',shpname)
roads<-readOGR(roadfilepath,shpname)
roads<-spTransform(roads,CRS('+proj=cea'))
try(rm('watershed.over'),silent=T)
watershed.over<-try(gIntersection(watershed.sub,roads),silent=T)
if(class(watershed.over)=='try-error')
{
bad<-!gIsValid(roads,byid=T)
roads[bad,]=gSimplify(roads[bad,],tol=0.0001)
watershed.over<-try(gIntersection(watershed.sub,roads),silent=T)
}
if(!is.null(watershed.over))
{
len<-road.lencalc(watershed.over)
watershed.road<-rbind(watershed.road,data.frame(SITEID=as.character(watershed.sub$SITEID),roadlen=len))
write.table(watershed.road,'~/Documents/gleon/roadlengthsByWatershed2.csv',col.names=T,quote=F,row.names=F,sep=',',append=F)
}
}
}
load()
load('~/Documents/richness files/richnessData.RData')
yrb
drv
source('~/Documents/richness files/richnessdatasummaries.r', echo=TRUE)
drv=dbDriver('SQLite')
yrb<-dbConnect(drv,'~/Documents/richness files/yrb.db')
dbListTables(yrb)
tables<-dbListTables(yrb)
grep('chem',tables)
grep('water',tables)
grep('Water',tables)
chem<-dbGetQuery(yrb,'select * from lakeChemCharacteristics where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4" ,"1_90_5", "1_98_4" )')
chem
chem<-dbGetQuery(yrb,'select * from lakeChemCharacteristics where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1")')
chem
chem<-dbGetQuery(yrb,'select * from lakeBaseInfo where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1")')
chem<-dbGetQuery(yrb,'select * from tbllakeBaseInfo where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1")')
lakeinfo<-dbGetQuery(yrb,'select * from tbllakeBaseInfo where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1")')
lakeinfo
chem<-dbGetQuery(yrb,'select * from lakeChemCharacteristics where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4","1_88_5" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1")')
chem
chem<-dbGetQuery(yrb,'select * from lakeChemCharacteristics where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4","1_88_5" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1")')
dbListTables(yrb)
bathy<-dbGetQuery(yrb,'select * from tblBathymetry where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4","1_88_5" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1")')
bathy<-dbGetQuery(yrb,'select * from tblBathymetry where transectid in (select distinct transectid,lakeid from tabletransects where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4","1_88_5" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1"))')
bathy<-dbGetQuery(yrb,'select * from tblBathymetry where transectid in (select distinct transectid,lakeid from tbltransects where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4","1_88_5" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1"))')
bathy<-dbGetQuery(yrb,'select * from tblBathymetry where transectid in (select transectid from tbltransects where lakeid in ("0_28_2", "0_89_1" ,"1_13_2" ,"1_69_2" ,"1_88_1" ,"1_88_2", "1_88_3" ,"1_88_4","1_88_5" ,"1_90_5", "1_98_4" ,"1_37_5","0_10_1"))')
bathy
newNLAall <- read.csv("~/Dropbox/NLA analyses/data/newNLAall.csv")
View(newNLAall)
setwd('..')
getwd()
setwd('')
setwd('vijay')
setwd('shinyTEM/')
setwd('..')
library(shiny)
runApp('shinyTEM')
library(shiny)
setwd('~/')
runApp('shinyTEM')
runApp('shinyTEM')
